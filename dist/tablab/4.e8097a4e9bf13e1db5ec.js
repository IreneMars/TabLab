(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{lBUW:function(t,e,i){"use strict";i.r(e),i.d(e,"AuthModule",function(){return G});var n=i("ofXK"),s=i("3Pt+"),r=i("rhD1"),a=i("tyNb"),o=i("mrSG"),c=i("jtHE"),l=i("fXoL"),u=i("lGQG"),h=i("XNiG"),m=i("quSY");class d extends h.a{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(t){return this.hasError?(t.error(this.thrownError),m.a.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),m.a.EMPTY):super._subscribe(t)}next(t){this.hasCompleted||(this.value=t,this.hasNext=!0)}error(t){this.hasCompleted||super.error(t)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}class g{}let b=(()=>{class t extends class{constructor(){}loadScript(t,e,i,n=null){if("undefined"!=typeof document&&!document.getElementById(t)){let t=document.createElement("script");t.async=!0,t.src=e,t.onload=i,n||(n=document.head),n.appendChild(t)}}}{constructor(t,e={scope:"email"}){super(),this.clientId=t,this.initOptions=e}initialize(){return new Promise((e,i)=>{try{this.loadScript(t.PROVIDER_ID,"https://apis.google.com/js/platform.js",()=>{gapi.load("auth2",()=>{this.auth2=gapi.auth2.init(Object.assign(Object.assign({},this.initOptions),{client_id:this.clientId})),this.auth2.then(()=>{e()}).catch(t=>{i(t)})})})}catch(n){i(n)}})}getLoginStatus(e){const i=Object.assign(Object.assign({},this.initOptions),e);return new Promise((e,n)=>{if(this.auth2.isSignedIn.get()){let t=new g;const n=this.auth2.currentUser.get().getBasicProfile(),s=this.auth2.currentUser.get().getAuthResponse(!0);t.id=n.getId(),t.name=n.getName(),t.email=n.getEmail(),t.photoUrl=n.getImageUrl(),t.firstName=n.getGivenName(),t.lastName=n.getFamilyName(),t.response=s;const r=i=>{t.authToken=i.access_token,t.idToken=i.id_token,e(t)};i.refreshToken?this.auth2.currentUser.get().reloadAuthResponse().then(r):r(this.auth2.currentUser.get().getAuthResponse(!0))}else n(`No user is currently logged in with ${t.PROVIDER_ID}`)})}signIn(t){const e=Object.assign(Object.assign({},this.initOptions),t);return new Promise((i,n)=>{(e&&e.offline_access?this.auth2.grantOfflineAccess(t):this.auth2.signIn(t)).then(t=>{let e=new g;if(t&&t.code)e.authorizationCode=t.code;else{let t=this.auth2.currentUser.get().getBasicProfile(),i=this.auth2.currentUser.get().getAuthResponse(!0),n=i.access_token,s=i.id_token;e.id=t.getId(),e.name=t.getName(),e.email=t.getEmail(),e.photoUrl=t.getImageUrl(),e.firstName=t.getGivenName(),e.lastName=t.getFamilyName(),e.authToken=n,e.idToken=s,e.response=i}i(e)},t=>{n(t)}).catch(t=>{n(t)})})}signOut(t){return new Promise((e,i)=>{let n;n=t?this.auth2.disconnect():this.auth2.signOut(),n.then(t=>{t?i(t):e()}).catch(t=>{i(t)})})}}return t.PROVIDER_ID="GOOGLE",t})(),p=(()=>{class t{constructor(t){this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new c.a(1),this.initialized=!1,this._initState=new d,t instanceof Promise?t.then(t=>{this.initialize(t)}):this.initialize(t)}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}initialize(t){this.autoLogin=void 0!==t.autoLogin&&t.autoLogin;const{onError:e=console.error}=t;t.providers.forEach(t=>{this.providers.set(t.id,t.provider)}),Promise.all(Array.from(this.providers.values()).map(t=>t.initialize())).then(()=>{if(this.autoLogin){const t=[];let e=!1;this.providers.forEach((i,n)=>{let s=i.getLoginStatus();t.push(s),s.then(t=>{t.provider=n,this._user=t,this._authState.next(t),e=!0}).catch(console.debug)}),Promise.all(t).catch(()=>{e||(this._user=null,this._authState.next(null))})}}).catch(t=>{e(t)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}refreshAuthToken(e){return new Promise((i,n)=>{if(this.initialized)if(e!==b.PROVIDER_ID)n(t.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const s=this.providers.get(e);s?s.getLoginStatus({refreshToken:!0}).then(t=>{t.provider=e,this._user=t,this._authState.next(t),i()}).catch(t=>{n(t)}):n(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else n(t.ERR_NOT_INITIALIZED)})}signIn(e,i){return new Promise((n,s)=>{if(this.initialized){let r=this.providers.get(e);r?r.signIn(i).then(t=>{t.provider=e,n(t),this._user=t,this._authState.next(t)}).catch(t=>{s(t)}):s(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else s(t.ERR_NOT_INITIALIZED)})}signOut(e=!1){return new Promise((i,n)=>{if(this.initialized)if(this._user){let s=this.providers.get(this._user.provider);s?s.signOut(e).then(()=>{i(),this._user=null,this._authState.next(null)}).catch(t=>{n(t)}):n(t.ERR_LOGIN_PROVIDER_NOT_FOUND)}else n(t.ERR_NOT_LOGGED_IN);else n(t.ERR_NOT_INITIALIZED)})}}return t.\u0275fac=function(e){return new(e||t)(l.Yb("SocialAuthServiceConfig"))},t.\u0275prov=l.Kb({token:t,factory:t.\u0275fac}),t.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",t.ERR_NOT_LOGGED_IN="Not logged in",t.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",t.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",t})(),f=(()=>{class t{constructor(t){if(t)throw new Error("SocialLoginModule is already loaded. Import it in the AppModule only")}static initialize(e){return{ngModule:t,providers:[p,{provide:"SocialAuthServiceConfig",useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(l.Yb(t,12))},t.\u0275mod=l.Mb({type:t}),t.\u0275inj=l.Lb({providers:[p],imports:[[n.c]]}),t})();var v=i("kmnG"),_=i("qFsG"),I=i("bSwM");function O(t,e){1&t&&(l.Ub(0,"small",20),l.Fc(1," Ingrese 5 letras "),l.Tb())}function T(t,e){1&t&&(l.Ub(0,"small",20),l.Fc(1," Ingrese una contrase\xf1a adecuada "),l.Tb())}function E(t,e){1&t&&(l.Ub(0,"button",21),l.Fc(1,"Iniciar Sesi\xf3n"),l.Tb())}function U(t,e){if(1&t){const t=l.Vb();l.Ub(0,"div",1),l.Ub(1,"div",2),l.Ub(2,"div",3),l.Ub(3,"div",4),l.Ub(4,"div",5),l.Ub(5,"form",6),l.bc("ngSubmit",function(){return l.xc(t),l.fc().onLogin()}),l.Ub(6,"h2",7),l.Fc(7,"Inicio de Sesi\xf3n"),l.Tb(),l.Ub(8,"mat-form-field"),l.Pb(9,"input",8),l.Ub(10,"mat-error"),l.Ec(11,O,2,0,"small",9),l.Tb(),l.Tb(),l.Ub(12,"mat-form-field"),l.Pb(13,"input",10),l.Ub(14,"mat-error"),l.Ec(15,T,2,0,"small",9),l.Tb(),l.Tb(),l.Ub(16,"div",11),l.Ub(17,"div",12),l.Ub(18,"mat-checkbox",13),l.Fc(19,"Recordar mi usuario"),l.Tb(),l.Tb(),l.Tb(),l.Ub(20,"div",14),l.Ub(21,"a",15),l.Fc(22," \xbfNo tienes cuenta? "),l.Tb(),l.Tb(),l.Ub(23,"div",16),l.Ec(24,E,2,0,"button",17),l.Tb(),l.Tb(),l.Ub(25,"div",18),l.Ub(26,"button",19),l.bc("click",function(){return l.xc(t),l.fc().onGoogleLogin()}),l.Fc(27,"Sign In with Google"),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb()}if(2&t){const t=l.fc();l.Db(5),l.mc("formGroup",t.loginForm),l.Db(4),l.Gb("is-invalid",t.invalidUsername),l.Db(2),l.mc("ngIf",t.invalidUsername),l.Db(2),l.Gb("is-invalid",t.invalidPassword),l.Db(2),l.mc("ngIf",t.invalidPassword),l.Db(9),l.mc("ngIf",!t.isLoading)}}let w=(()=>{class t{constructor(t,e,i,n){this.authService=t,this.formBuilder=e,this.socialAuthService=i,this.router=n,this.isLoading=!1,this.subject=new c.a(1),this.createForm(),gapi.load("auth2",()=>{gapi.auth2.init({client_id:"303403440470-ov4hqkp88j4uflfclvd5pltnklc3uejk.apps.googleusercontent.com"})})}createForm(){this.loginForm=this.formBuilder.group({username:["",[s.s.required,s.s.minLength(4)]],password:["",s.s.required],rememberme:[!1]})}ngOnInit(){localStorage.getItem("email")&&this.loginForm.reset({username:localStorage.getItem("username"),rememberme:!0}),this.url=window.location.hostname.includes("localhost")?"http://localhost:3000/api/auth/google":"https://tablab-app.herokuapp.com/api/auth/google",this.socialAuthService.authState.subscribe(t=>{this.user=t,this.loggedIn=null!=t})}get invalidUsername(){return this.loginForm.get("username").invalid&&this.loginForm.get("username").touched}get invalidEmail(){return this.loginForm.get("email").invalid&&this.loginForm.get("email").touched}get invalidPassword(){return this.loginForm.get("password").invalid}onLogin(){if(this.loginForm.invalid)return Object.values(this.loginForm.controls).forEach(t=>{t instanceof s.f?Object.values(t.controls).forEach(t=>t.markAsTouched()):t.markAsTouched()});this.isLoading=!0;const t=this.loginForm.getRawValue();this.authService.login(t.username,t.password),t.rememberme?localStorage.setItem("username",t.username):localStorage.removeItem("username"),this.isLoading=!1}onGoogleLogin(){return Object(o.a)(this,void 0,void 0,function*(){if(this.auth2=gapi.auth2.getAuthInstance(),this.isLoading=!0,this.auth2.isSignedIn.get())console.log("Already signed in!");else{yield this.auth2.signIn();const t=this.auth2.currentUser.get().getAuthResponse().id_token;this.authService.googleLogin(t),this.isLoading=!1}})}observable(){return this.subject.asObservable()}}return t.\u0275fac=function(e){return new(e||t)(l.Ob(u.a),l.Ob(s.c),l.Ob(p),l.Ob(a.b))},t.\u0275cmp=l.Ib({type:t,selectors:[["app-login"]],decls:1,vars:1,consts:[["class","row mt-5",4,"ngIf"],[1,"row","mt-5"],[1,"col","d-flex","justify-content-md-center"],[2,"min-width","30%"],[1,"card","animate__animated","animate__fadeIn","animate__faster"],[1,"card-body"],[3,"formGroup","ngSubmit"],[1,"card-title"],["matInput","","type","text","placeholder","Nombre","formControlName","username"],["class","text-danger",4,"ngIf"],["matInput","","type","password","placeholder","Contrase\xf1a","formControlName","password"],[1,"flex-sb-m","w-full","p-t-3","p-b-24"],[1,"contact100-form-checkbox"],["formControlName","rememberme",1,"example-margin","mt-2"],[1,"text-center","mt-3"],["routerLink","/auth/signup"],[1,"d-grid","gap-2"],["type","submit","class","mt-3 btn btn-primary btn-block",4,"ngIf"],[1,"d-grid","gap-2","mt-1"],["type","button",1,"btn","btn-primary",3,"click"],[1,"text-danger"],["type","submit",1,"mt-3","btn","btn-primary","btn-block"]],template:function(t,e){1&t&&l.Ec(0,U,28,8,"div",0),2&t&&l.mc("ngIf",!e.isLoading)},directives:[n.l,s.t,s.m,s.g,v.c,_.a,s.b,s.l,s.e,v.b,I.a,a.e],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-card[_ngcontent-%COMP%]{display:block;margin-top:1rem}"]}),t})();var R=i("6Qg2"),S=i("952Z");function N(t,e){1&t&&(l.Ub(0,"small",15),l.Fc(1," Ingrese un nombre de usuario adecuado (mayor de 5 letras). "),l.Tb())}function F(t,e){1&t&&(l.Ub(0,"small",15),l.Fc(1," Ingrese un correo adecuado "),l.Tb())}function L(t,e){1&t&&(l.Ub(0,"small",15),l.Fc(1," Ingrese una contrase\xf1a adecuada "),l.Tb())}function y(t,e){1&t&&(l.Ub(0,"button",16),l.Fc(1,"Registrar"),l.Tb())}function P(t,e){if(1&t){const t=l.Vb();l.Ub(0,"div",1),l.Ub(1,"div",2),l.Ub(2,"div",3),l.Ub(3,"div",4),l.Ub(4,"form",5),l.bc("ngSubmit",function(){return l.xc(t),l.fc().onSignup()}),l.Ub(5,"h2",6),l.Fc(6,"Registro"),l.Tb(),l.Ub(7,"mat-form-field"),l.Pb(8,"input",7),l.Ub(9,"mat-error"),l.Ec(10,N,2,0,"small",8),l.Tb(),l.Tb(),l.Ub(11,"mat-form-field"),l.Pb(12,"input",9),l.Ub(13,"mat-error"),l.Ec(14,F,2,0,"small",8),l.Tb(),l.Tb(),l.Ub(15,"mat-form-field"),l.Pb(16,"input",10),l.Ub(17,"mat-error"),l.Ec(18,L,2,0,"small",8),l.Tb(),l.Tb(),l.Ub(19,"div",11),l.Ec(20,y,2,0,"button",12),l.Tb(),l.Ub(21,"div",13),l.Ub(22,"a",14),l.Fc(23," \xbfYa tienes una cuenta? "),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb(),l.Tb()}if(2&t){const t=l.fc();l.Db(4),l.mc("formGroup",t.signupForm),l.Db(4),l.Gb("is-invalid",t.invalidUsername),l.Db(2),l.mc("ngIf",t.invalidUsername),l.Db(2),l.Gb("is-invalid",t.invalidEmail),l.Db(2),l.mc("ngIf",t.invalidEmail),l.Db(2),l.Gb("is-invalid",t.invalidPassword),l.Db(2),l.mc("ngIf",t.invalidPassword),l.Db(2),l.mc("ngIf",!t.isLoading)}}const k=[{path:"login",component:w},{path:"signup",component:(()=>{class t{constructor(t,e,i,n,s){this.authService=t,this.usersService=e,this.formBuilder=i,this.router=n,this.workspacesService=s,this.isLoading=!1,this.createForm()}createForm(){this.signupForm=this.formBuilder.group({username:["",[s.s.required,s.s.minLength(5)]],email:["",[s.s.required,s.s.pattern("[a-z0-9._%+-]+@[a-z0-9._]+.[a-z]{2,3}$")]],password:["",s.s.required]})}ngOnInit(){this.authService.getAuthStatusListener().subscribe(t=>{this.isLoading=!1})}get invalidUsername(){return this.signupForm.get("username").invalid&&this.signupForm.get("username").touched}get invalidEmail(){return this.signupForm.get("email").invalid&&this.signupForm.get("email").touched}get invalidPassword(){return this.signupForm.get("password").invalid}onSignup(){return Object(o.a)(this,void 0,void 0,function*(){if(this.signupForm.invalid)return Object.values(this.signupForm.controls).forEach(t=>{t instanceof s.f?Object.values(t.controls).forEach(t=>t.markAsTouched()):t.markAsTouched()});this.isLoading=!0;const t=this.signupForm.getRawValue();this.usersService.addUser(t.username,t.email,t.password).then(t=>{this.router.navigate(["/"])}).catch(t=>{console.log("Error creating an user: "+t.message)})})}}return t.\u0275fac=function(e){return new(e||t)(l.Ob(u.a),l.Ob(R.a),l.Ob(s.c),l.Ob(a.b),l.Ob(S.a))},t.\u0275cmp=l.Ib({type:t,selectors:[["app-signup"]],decls:1,vars:1,consts:[["class","row justify-content-sm-center mt-5",4,"ngIf"],[1,"row","justify-content-sm-center","mt-5"],[1,"col-sm-auto"],[1,"card","animate__animated","animate__fadeIn","animate__faster"],[1,"card-body"],[3,"formGroup","ngSubmit"],[1,"card-title"],["matInput","","type","text","placeholder","Nombre","formControlName","username"],["class","text-danger",4,"ngIf"],["matInput","","type","email","placeholder","Correo electr\xf3nico","formControlName","email"],["matInput","","type","password","placeholder","Contrase\xf1a","formControlName","password"],[1,"d-grid","gap-2"],["type","submit","class","mt-3 btn btn-primary btn-block",4,"ngIf"],[1,"text-center","mt-3"],["routerLink","/auth/login"],[1,"text-danger"],["type","submit",1,"mt-3","btn","btn-primary","btn-block"]],template:function(t,e){1&t&&l.Ec(0,P,24,11,"div",0),2&t&&l.mc("ngIf",!e.isLoading)},directives:[n.l,s.t,s.m,s.g,v.c,_.a,s.b,s.l,s.e,v.b,a.e],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-card[_ngcontent-%COMP%]{display:block;margin-top:1rem}"]}),t})()}];let D=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Mb({type:t}),t.\u0275inj=l.Lb({imports:[[a.f.forChild(k)],a.f]}),t})();var x=i("j1ZV");let G=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Mb({type:t}),t.\u0275inj=l.Lb({providers:[{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!1,providers:[{id:b.PROVIDER_ID,provider:new b("303403440470-ov4hqkp88j4uflfclvd5pltnklc3uejk.apps.googleusercontent.com")}]}}],imports:[[n.c,r.a,s.h,D,s.q,a.f,x.a,f]]}),t})()}}]);